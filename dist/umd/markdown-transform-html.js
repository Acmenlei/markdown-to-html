!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MarkdownTransformer={})}(this,(function(t){"use strict";function e(t,e=!1){let n=function(t){let e="",n=-1;for(;-1!=(n=t.indexOf("**"));){e+=t.slice(0,n);let i=(t=t.slice(n+2)).indexOf("**");if(-1==i){t="**"+t;break}e+=`<strong>${t.slice(0,i)}</strong>`,t=t.slice(i+2)}return t&&(e+=t),e}(t);return n=function(t){let e="",n=-1;for(;-1!=(n=t.indexOf("*"));){e+=t.slice(0,n);let i=(t=t.slice(n+1)).indexOf("*");if(-1==i){t="*"+t;break}e+=`<i>${t.slice(0,i)}</i>`,t=t.slice(i+1)}return t&&(e+=t),e}(n),n=function(t){let e="",n=-1;for(;-1!=(n=t.indexOf("`"));){e+=t.slice(0,n);let i=(t=t.slice(n+1)).indexOf("`");if(-1==i){t="`"+t;break}e+=`<code class=single-code>${t.slice(0,i)}</code>`,t=t.slice(i+1)}return t&&(e+=t),e}(n),n=function(t){let e="",n=-1;for(;-1!=(n=t.indexOf("~~"));){e+=t.slice(0,n);let i=(t=t.slice(n+2)).indexOf("~~");if(-1==i){t="~~"+t;break}e+=`<del>${t.slice(0,i)}</del>`,t=t.slice(i+2)}return t&&(e+=t),e}(n),n=function(t){let e="";for(;l.test(t);){let n=t.indexOf("![");e+=t.slice(0,n);let i=(t=t.slice(n+2)).indexOf("]("),r=t.slice(0,i),l=(t=t.slice(i+2)).indexOf(")"),s=t.slice(0,l);t=t.slice(l+1),e+=`<img alt=${r} src=${s} />`}return e+t}(n),n=function(t){let e="";for(;r.test(t);){let n=t.indexOf("[");e+=t.slice(0,n);let i=(t=t.slice(n+1)).indexOf("]("),r=t.slice(0,i),l=(t=t.slice(i+2)).indexOf(")"),s=t.slice(0,l);t=t.slice(l+1),e+=`<a href=${s} target="_blank">${r}</a>`}return e+t}(n),n=function(t){return t.replace(/icon:(\w+)(\s|\b)/g,((t,e)=>`<i class='iconfont icon-${e}'></i>`))}(n),n}const n=/^(#+)\s(.*)/g,i=/^\s*(\d+)\.\s(.+)/,r=/\[(.*)\]\((.*)\)/,l=/!\[(.*)\]\((.*)\)/;function s(t){/^\s+/.test(t[0])&&(t[0]=t[0].replace(/^(\s+)/g,(t=>"\n"))),t[0].startsWith("\n")||(t[0]="\n"+t[0])}function c(t,n){let i="";for(let r of t){let t=r.children.length?c(r.children,n):"";i+=`<li>${e(r.value+t,!0)}</li>`}return`<${n?"ol":"ul"}>${i}</${n?"ol":"ul"}>`}function u(t){return i.test(t)}function o(t){let e=t.indexOf("- ");return 0==e||-1!=e&&!t.slice(0,e).trim()}function f(t){return"#"===t.trimStart()[0]}function a(t){return t.startsWith("```")}function d(t){return/^>/.test(t.trim())}function h(t){return"---"===t.trim()}function g(t){return"|"===t.trim()[0]}function x(t){return"::: start"===t.trim()}function m(t){return":::"===t.trim()}function p(t){return"::: headStart"===t.trim()}function b(t){return"::: mainStart"===t.trim()}function O(t){return`<blockquote>${t.slice(1)}</blockquote>`}function $(t,e,n,i){let r="",l=t[e].slice(3).trim().toLowerCase();for(++e;e<n&&!t[e].startsWith("```");)r+=t[e]+"\n",e++;t[e]="";const s=[i.highlight?`language-${l}`:"",i.lineNumber?"line-numbers":""].join(" ");return r=`<pre><code ${s&&`class='${s}'`}>${r}</code></pre>`,{startIdx:e,result:r}}function v(t,e,n){let i="";for(;e<n;e++)if(t[e].trim()){if("-"!==t[e].trim()[0]||-1==t[e].indexOf("-"))break;i+=t[e]+"\n"}return i=function(t){const e=t.match(/(\s?)*-\s(.+)/g);if(!e)return t;s(e);const n=function(t){const e=[],n=[],i=t.length;for(let r=0;r<i;r++){const i=t[r].indexOf("- "),l={children:[],value:t[r].slice(i+2),level:i,parent:null};if(!n.length){e.push(l),n.push(l);continue}const s=n[n.length-1].level,c=t[r].indexOf("-");let u;if(s===c)u=n[n.length-1].parent;else if(s>c){for(;n[n.length-1].level>c;)n.pop();u=n[n.length-1].parent}else u=n[n.length-1];l.parent=u,u?u.children.push(l):e.push(l),n.push(l)}return e}(e);return c(n,!1)}(i),{startIdx:e,result:i}}function I(t,e,n){let i="";for(;e<n;e++)if(t[e].trim()){if(!u(t[e]))break;i+=t[e]+"\n"}return i=function(t){const e=t.match(/\s*\d+\.\s(.+)/g);if(!e)return t;s(e);const n=function(t){const e=[],n=[],i=t.length;for(let r=0;r<i;r++){let i=0;u(t[r])&&(i=t[r].indexOf(String(RegExp.$1+".")));const l={children:[],value:RegExp.$2,level:i,parent:null};if(!n.length){e.push(l),n.push(l);continue}const s=n[n.length-1].level,c=i;let o;if(s===c)o=n[n.length-1].parent;else if(s>c){for(;n[n.length-1].level>c;)n.pop();o=n[n.length-1].parent}else o=n[n.length-1];l.parent=o,o?o.children.push(l):e.push(l),n.push(l)}return e}(e);return c(n,!0)}(i),{startIdx:e,result:i}}function j(t){return t.length>6?6:t.length}function k(t){return t.trim().replace(n,((t,n,i)=>`<h${j(n)}>${e(i,!0)}</h${j(n)}>`))}function y(t,e,n){let i="<table>";for(i+=function(t){let e=-1,n="<thead><tr>";for(let i=0,r=t.length;i<r;i++)"|"==t[i]&&w(t,i-1)&&w(t,i+1)&&(-1!=e&&(n+=`<th>${t.slice(e+1,i)}</th>`),e=i);return n+"</tr></thead>"}(t[e]),i+="<tbody >",++e;e<n&&"|"===t[e].trim()[0];e++)i+=T(t[e]);return i+="</tbody></table>",{startIdx:e-1,result:i}}function T(t){let e=-1,n="<tr>";for(let i=0,r=t.length;i<r;i++)if("|"==t[i]&&w(t,i-1)&&w(t,i+1)){if(-1!=e){let r=t.slice(e+1,i);if("-"===r.trim()[0])continue;n+=`<td>${r}</td>`}e=i}return n+"</tr>"}function w(t,e){return" "===t[e]||null==t[e]}function E(t,e,n,i){let r="<div class=head-layout>",l="";for(++e;e<n&&"::: headEnd"!==t[e].trim();)t[e].trim()&&(l+=t[e]+"\n"),e++;return r+=L(l,Object.assign(Object.assign({},i),{xss:!1}))+"</div>",{result:r,startIdx:e}}function S(t,e,n,i){let r="<div class=flex-layout>",l="";for(++e;e<n&&"::: end"!==t[e].trim();){if(x(t[e])){const{result:r,startIdx:s}=S(t,e,n,i);l+=r,e=s}else if(p(t[e])){const{result:r,startIdx:s}=E(t,e,n,i);l+=r,e=s}else m(t[e])?(r+=`<div class=flex-layout-item>${L(l,Object.assign(Object.assign({},i),{xss:!1}))}</div>`,l=""):l+=t[e].trim()?"\n"+t[e]+"\n":"";e++}return r+=`<div class=flex-layout-item>${L(l,Object.assign(Object.assign({},i),{xss:!1}))}</div>`,r+="</div>",{result:r,startIdx:e}}function W(t,e,n,i){let r="<div class=main-layout>",l="";for(++e;e<n&&"::: mainEnd"!==t[e].trim();)t[e].trim()&&(l+=t[e]+"\n"),e++;return r+=L(l,Object.assign(Object.assign({},i),{xss:!1}))+"</div>",{result:r,startIdx:e}}const q={lineNumber:!1,highlight:!1,xss:!0};function L(t,n){let i=n||q,r="";i=Object.assign(Object.assign({},q),i);let l=i.xss?(c=t,c.replace(/</g,"&lt;")).split("\n"):t.split("\n"),s=(null==l?void 0:l.length)||0;var c,m;for(let t=0;t<s;){if(f(l[t]))r+=k(l[t]);else if(p(l[t])){const{result:e,startIdx:n}=E(l,t,s,i);t=n,r+=e}else if(b(l[t])){const{result:e,startIdx:n}=W(l,t,s,i);t=n,r+=e}else if(x(l[t])){const{result:e,startIdx:n}=S(l,t,s,i);t=n,r+=e}else if(h(l[t]))r+=3!==(m=l[t]).length?m:"---"===m?"<hr/>":m,++t;else if(g(l[t])){const{result:e,startIdx:n}=y(l,t,s);t=n,r+=e}else if(o(l[t])){const{result:e,startIdx:n}=v(l,t,s);t=n-1,r+=e}else if(u(l[t])){const{result:e,startIdx:n}=I(l,t,s);t=n-1,r+=e}else if(a(l[t])){const{result:e,startIdx:n}=$(l,t,s,i);t=n,r+=e}else d(l[t].trim())?r+=O(l[t].trim()):(l[t]=l[t].trim())&&(r+=e(l[t]));t++}return r}t.markdownToHTML=L}));
